# 2장 바운디드 컨텍스트 및 보편언어와 전략적 설계

- 바운디드 컨텍스트(BOUNDED CONTEXT)
- 보편언어(Ubiquitous Language)

DDD는 주로 명확하게 바운디드 컨텍스트 내에서 보편언어를 모델링하는 것에 대한 것이다.

1. 바운디드 컨텍스트란 동일한 컨텍스트의 범위를 표현한다.
2. 바운디드 컨텍스트는 모델이 구현되는 곳이다.
3. 바운디드 컨테스트마다 분리된 소프트웨어 산출물이 나온다.
4. 범주 내에서 소프트웨어 모델의 각 컴포넌트는 특정한 의미를 갖는다.
5. 특정한 의미를 갖는 컴포넌트는 각각의 특정한 일을 수행한다.
6. 바운디드 컨텍스트에 존재하는 컴포넌트들은 컨텍스트에 특화돼 있으며, 컨텍스트 안에서 의미가 살아난다.

초기 모델링 작업에서 바운디드 컨텍스트는 다소 개념적인 수준이다.

- 모델링 작업은 문제 영역에서 해결 영역으로 도출하는 과정이다.

이때 개념적인 수준을 문제 영역(problem space)의 일부라고 생각할 수도 있지만, 모델이 더 깊은 의미와 명확성을 받아들이게 되면서 바운디드 컨텍스트는 빠르게 해결 영역(solution space)으로
전환되고 소프트웨어 모델은 프로젝트 소스 코드로 반영되기 시작할 것이다.

### 문제 영역과 해결 영역

문제 영역이란 상위 수준의 전략적 분석을 수행한다.

- 주어진 프로젝트 제약사항 내에서 단계를 설계하는 곳이다.
- 상위 수준의 프로젝트 요인에 대해 논의하고, 주요 목표와 위험 사항에 대해 이야기 하면서 간단한 다이어그램을 사용할 수도 있다.
- 컨텍스트 맵은 문제 영역에서 매우 잘 활용한다.
- 바운디드 컨텍스트는 문제 영역 논의에서 사용할 수 있지만, 필요에 따라 해결 영역과도 밀접하게 관련된다는 것을 잘 기억해두자.

해결 영역은 문제 영역의 논의가 **`핵심 도메인`** 으로 바라보는 해결 방안을 구현하는 곳이다.

- 바운디드 컨텍스트를 조직의 핵심 전략 계획으로 개발하고 있을 때, 이를 **`핵심 도메인`** 이라고 한다.
- 바운디드 컨텍스트 내에서 메인 소스, 테스트 소스 코드로 해결 방안을 개발한다.
- 다른 바운디드 컨텍스트와의 통합을 지원하는 해결 영역에서도 코드를 생산한다.

### 핵심 도메인

컨텍스트 범위 내의 소프트웨어 모델은 바운디드 컨텍스트 안에서 일하는 팀이 보편 언어를 사용하여 생성한다. 따라서 보편 언어는 엄격하고, 정확하고, 엄중하며, 단호해야한다.

핵심 도메인은 가장 중요한 소프트웨어 모델 중 하나로 가치 있는 것들을 달성하는 수단이 된다. 이 때문에 핵심 도메인은 최소한 하나의 주요 사업 부분을 다룬다.

- 조직은 모든 것을 뛰어날 수는 없다. 또 그렇게 만들려고 해서도 안된다.
- 기업은 올바른 전략적 결정을 위해 무엇이 핵심 도메인이어야 하고, 어떤 것을 제외시켜야 하는지 현명하게 선택해야한다.
- 이것이 DDD의 주된 가치 제안이고, 핵심 도메인에 최적의 자원을 투여해서 적절하게 투자해야 한다.

### 보편언어

팀의 누군가가 보편언어 표현을 사용하면, 팀 모두가 그 표현이 가진 제약사항과 정확한 의미를 이해한다.

- 동일한 용어는 각각의 바운디드 컨텍스트마다 그 의미가 다를 수 있다.
- 바운디드 컨텍스트는 마치 언어의 경계와 비슷하다.
- 보편적 언어라는 것은 소프트웨어 모델을 소용하는 팀이 이야기할 때 사용하는 것이다.
- 이 언어의 대표적인 기록 형태는 바로 소프트웨어 모델의 소스 코드다.

### 바운디드 컨텍스트, 팀 그리고 소스 코드 리파지토리

- 각각의 바운디드 컨텍스트는 단일 팀에만 할당돼야 한다.
- 각 바운디드 컨텍스트마다 독립적인 소스 코드 리파지토리가 있어야 한다.
- 한 팀이 다수의 바운디드 컨테스트에 대해 일할 수 있다.
- 다수의 팀이 하나의 바운디드 컨텍스트에 대해 일할 수 없다.
- 보편언어를 나눈 것과 마찬가지로 바운디드 컨텍스트마다 소스 코드, 데이터베이스 스키마도 명확히 분리해야한다.

바운디드 컨텍스트에 따른 독립적인 구성은 각자의 소스 코드와 데이터베이스를 소유하고, 공식 인터페이스를 정의해서 바운디드 컨텍스트를 다른 팀이 사용할 수 있게 허용한다. 이것이 바로 DDD 사용의 이점이다.

### 진흙 덩어리

바운디드 컨텍스트를 사용하는 중요한 이유 중 한 가지를 이해하기 위해 소프트웨어 설계에서 흔히 일어날 수 있는 문제를 생각해보자.

- [V] 도메인 모델을 작고 관리할 수 있는 정도로 시작했다.
- [V] 점점 더 많은 개념이 쌓이는 것을 언제 멈춰야 하는지 모를 때가 자주 있다.
- [V] 하지만 더 많은 개념을 계속 추가한다.
- [V] 나중에 커다란 문제로 발전한다.
- [V] 하나의 거대하고, 혼란스럽고, 경계가 제한되지 않은 모델 안에 너무 많은 개념이 존재한다.
- [V] 다수의 언어가 혼재되면서 점차 하나의 모델 내의 사용하는 언어가 모호해지기 시작한다.

하나의 모델의 문제점은 새로운 소프트웨어 제품을 큰 진흙 덩어리처럼 만드는 요인이다.

애플리케이션에서 큰 진흙 덩어리는 무의미하거나 더 좋지 않은 결과를 도출한다.

- 소스 코드를 검증하기 어려워 테스트를 건너뛰거나 오랜시간이 걸린다.
- 한 개념이 수많은 모듈로 확장되거나 어울리지 않는 모듈을 상호 연계시킬 수도 있다.

## 도메인 전문가와 비즈니스 동인

더 나은 모델을 도출하기 위해선 모든 비즈니스 이해관계자들의 이야기에 귀 기울어야 한다.

큰 진흙 덩어리는 이런 비즈니스 전문가의 이야기에 귀를 기울이지 않은 채, 소프트웨어 개발 팀이 제멋대로 노력한 결과다.

산업 부서나 업무 그룹 단위는 모델 경계를 정의할 때 좋은 실마리를 제공해준다.

- 각 사업 기능이 같은 단어에 대해 서로 다른 정의를 가질 수 있다.
- 같은 단어가 각 부서마다 다른 의미를 갖는다면 통합하지 마라.
- 서로 다른 개념들을 각기 다른 바운디드 컨텍스트 안으로 분리해 놓음으로써 개념 간 차이를 더욱 중시하도록 설계해야 한다.

### 핵심은 무엇인가

기본적인 전략적 설계를 하려면, 바운디드 컨텍스트와 보편언어를 잘 활용해야 한다.

바운디드 컨텍스트를 사용한다는 것은, 비즈니스 전문가와의 논의에서 "핵심은 무엇인가?"라는 질문에 답하도록 유도해야 된다는 의미다.

- 바운디드 컨텍스트는 전략적 계획의 핵심이 되는 모든 개념들을 밀접하게 유지하면서 포용해야 하고, 나머지 모두 제외시켜야 한다.
- 바운디드 컨텍스트에 남은 개념들은 팀이 사용하는 보편언어의 일부가 된다.

### 독립, 분리, 핵심

바운디드 컨텍스트는 한 진흙 덩어리로 뭉쳐지지 않기 때문에 테스트를 하나의 모델에 집중할 수 있게 도와준다.

- 하나의 모델에 집중할 수 있기 때문에, 테스트할 양이 적어지고, 더 빨리 테스트를 수행할 수 있다는 점이다.
- 바운디드 컨텍스트를 사용하는 주된 동기는 아니지만, 이 의미만으로도 확실한 가치가 있다.
- 엄격하게 핵심만 걸러내어 정의한 개념들은 보편언어로 사용한다.

### 도메인 전문가와 개발자

핵심이 무엇인지 어떻게 알 수 있을까?

이를 위해서는 필수적인 두 가지 그룹(도메인 전문가와 소프트웨어 개발자)을 하나로 묶어 서로 협업하는 팀을 만들어야 한다.

- 도메인 전문가는 비즈니스 문제에 좀 더 집중할 것이다.
- 그들의 생각은 비즈니스가 동작하는 방법에 대한 비전에 의미를 둔다.
- 스크럼 도메인에서는 스크럼이 프로젝트에서 어떻게 실행되는지 완벽하게 이해하고 있는 스크럼 마스터가 도메인 전문가다.

스크럼 제품 책임자와 DDD 도메인 전문가는 차이가 있다.

- 제품 책임자가 보통 제품 백로그를 관리하고 우선순위를 정한다.
- 그리고 프로젝트의 개념적이고 기술적인 연관성이 유지되도록 하는 것에 좀 더 신경 쓰는 것이 바람직하다.
- 그렇다고 해서 반드시 제품 책임자가 비즈니스의 핵심 경쟁력의 전문가여야 한다는 점은 아니다.
- 반드시 팀 내에 진짜 도메인 전문가를 둬야 한다.
- 필수적인 노하우가 없다면 그가 제품 책임자를 대신하면 안된다.

도메인 전문가는 다양한 비즈니스 영역들마다 존재한다.

- 이것은 직책이 아니라 주로 비즈니스에 중점을 두는 사람들을 지칭한다.
- 팀의 보편언어의 토대는 비즈니스를 바탕으로 한 도메인 전문가들의 **`멘탈 모델`** 이다.

반면 개발자는 소프트웨어 개발에 중점을 둔다.

DDD 프로젝트를 수행하는 개발자는 핵심 전략 목표의 비즈니스 초점을 받아들이지 못하는 기술 중심의 주장을 하지 않도록 주의해야 한다.

- 근거 없는 간결성을 피한다.
- 바운디드 컨텍스트 안에 팀이 점진적으로 개발하는 보편언어를 수용할 수 있어야 한다.
- 기술적 복잡도가 아닌 비즈니스 복잡도에 집중하라
- DDD를 사용하는 이유는 비즈니스 모델의 복잡도가 높기 때문이다.
- 그렇다고 해서 도메인 모델이 가져야 하는 복잡도 이상으로 더 복잡한 모델을 만들 이유는 없다.
- 기술적 측면보다 비즈니스 모델이 더 복잡하기 때문에 DDD를 사용한다.
- 이것이 바로 개발자가 도메인 전문가와 함께 비즈니스 모델을 파고들어야 하는 이유다.

개발자와 도메인 전문가 모두 문서가 대화를 지배하는 상황을 피해야한다.

최고의 보편언어는 서로 협업하며 나오는 거듭된 피드백에 의해 만들어진다.

이 과정에서 팀의 화합된 멘탈 모델을 만들 수 있다. 열려 있는 대화, 탐구 그리고 현재의 지식 기반에 대한 도전의 결과는 핵심 도메인에 대한 더 깊은 통찰로 이어질 것이다.

## 도전과 통합

돌이켜 통제 불능으로 끝없이 확장되고 있던 모델에 대해 "핵심이 무엇인가?"라는 질문을 통해 다시 도전하고 통합해보자.

- [V] 가장 먼저 거대한 모델의 각 개념들이 스크럼의 보편언어를 따르는지 살펴봐야 한다.
- [V] 보편언어를 따르지 않는 개념이라면, 소프트웨어 모델에서 제외해야 한다.
- [V] 컨텍스트 밖에 개념이라면, 소프트웨어 모델에서 제외해야 한다.
- [V] 추후 추가해야할 모델이더라도, 현재 시점에 컨텍스트 밖에 개념이라면 제외한다.
- [V] 컨텍스트 내의 핵심 개념이라면, 핵심 모델 언어에 포함한다.
- [V] 컨텍스트 내의 핵심 모델은 다른 컨텍스트와의 협업(협업 컨텍스트)을 통해 보다 적절하게 동작하게 된다.

## 보편언어 개발하기

핵심 도메인을 명사에만 제한시킬 필요가 없다.

- 그보다는 핵심 도메인이 도메인 모델에 나타난 개념에 대한 구체적인 시나리오들을 나타낼 수 있게 만들어야 한다.
- 여기서 "시나리오"는 소프트웨어 프로젝트에서 흔히 말하는 유스케이스나 사용자 스토리 같은 것을 의미하진 않는다.

보편언어는 개발자와 도메인 전문가의 협업을 통해 가장 완벽한 방법으로 완성할 수 있다.

1. 각 백로그 아이템을 스프린트에 할당한다.
2. 백로그 아이템은 이미 릴리스에 예정돼 있는 경우에만 할당될 수 있다.
3. 만일, 이미 다른 스프린트에 할당됐다면 먼저 이를 해제시킨다.
4. 할당이 완료되면 관련된 대상에게 알린다.

시나리오는 단지 사람이 프로젝트에서 스크럼을 사용하는 방법만을 의미하는 것은 아니다.

사람이 수행할 절차에 대해 이야기하는 것이 아니기 때문이다. 시나리오는 매우 실제적인 소프트웨어 모델 컴포넌트들이 스크럼 기반 프로젝트 관리르 지원하기 위해 어떻게 동작할 것인지를 나타내는 세부사항이다.

시나리오는 명사, 동사, 부사 그리고 다른 종류의 문법도 포함한다. 실제로 도메인 모델이 어떻게 동작하는지 그리고 그 설계에 대해 대화할 수 있다는 것이 가장 중요한 이점이자 도움이 되는 특징이다. 시나리오는 단순히 그림이나 다이어그램일 수 있다.

하지만 그림이나 다이어그램와 같은 문서 형태는 최신 상태로 유지해야 하는 경우가 많다. 이는 도메인 모델링에 쏟는 노력에 허비되는 시간이 많아진다.

문서 자체는 도메인 모델이 아니다.

- 도메인 모델 개발을 도와주는 도구일 뿐이다. 결국엔 코드가 모델이고, 모델이 코드다.
- 시나리오는 부담스럽지 않는 선에서 선택하고 도메인 모델에 도움이될 만한 선에서 도출해야 한다.

보편언어를 개선하려면 시나리오 안의 각 대표적 역할마다 이름을 부여하고, 백로그 아이템, 스프린트 같은 개념들을 구분짓는 특성을 부여해야 한다. 시나리오를 수용 기준에 대한 명세서보다 좀 더 구체적인 내용으로 만들어준다.

시나리오 안의 개념에 이름을 붙이거나 구별할 수 있는 정체성을 부여하는 것이 도움될 때만, 별도의 이름과 구분짓는 특성을 부여한다.

개인적이고 독단적으로 스프린트에 할당할 백로그 아이템을 결정할 수는 없다. 소프트웨어 모델에서는 한 명의 개인에게 모델의 특정 행동을 수행하도록 채임을 주는 것이 더 실용적일 수 있다. 이 경우에는 제품 책임자가 행위를 수행하는 것으로 명시한다.

### 작업에 시나리오 넣기

정제된 시나리오를 팀의 명세서와 비교해 어떻게 도메인 모델을 검증하는 데 사용할 수 있을까?

**`사례를 통한 명세`** 라고 불리는 기술로 통해 시나리오를 검증할 수 있다. 이를 `행위 주도 개발(BDD, Behavior-Driven Development)` 라고도 불린다.

- 이 접근법의 목적은 공유된 이해를 기반으로 보편언어와 모델을 협업을 통해 개발 및 정제한다.
- 모델이 명세서를 준수하고 있는지를 확인하는 것이다.
- 인수 테스트를 만들어보면서 이를 수행할 수 있는지 앞의 시나리오를 어떻게 실행 가능한 명세로 수정할 수 있는지 검증한다.

인수 테스트에 대한 단위 테스트 기반 접근법은 실행 가능한 명세와 동일한 목적을 달성시켜준다.

가독성 문제가 조금 있지만. 이런 방식의 장점은 좀 더 신속하게 시나리오를 검증할 수 있다는 점이다. 물론, 대부분의 도메인 전문가는 이 코드를 파악하기 위해 개발자로부터 약간의 도움을 받아야 할 것이다.

초기에 개발된 보편언어라도 끊임 없이 성장해 간다.

실제로 중요도가 조금 떨어질 수 는 있지만, 초기 보편언어를 유지해야한다는 큰 착각에서 벗어나야 한다.

## 아키텍처

바운디드 컨텍스트 안에는 무엇이 있을까?

```text
- Domain Event
- Input Adapter
    - REST endpoints
    - Message Listeners
- Application Services
    - security
    - transaction
    - work coordination
    - usecase controller
- Domain model
    - entity
    - business logic
    - domain event
- Persistence or Infra
    - repository
    - documents
    - caching
    - messages
- Output Adapter
    - Persistence Management
    - message senders
```

위는 예시이고, DDD 의 아키텍처에서 어뎁터와 포트 개념의 아키텍처를 반드시 사용할 필요는 없다.

다른 아키텍처나 목적에 따라 다른 아키텍처 패턴을 조합해서 사용할 수 도 있다.

- 이벤트 주도 아키텍처(이벤트 소싱)
- 커맨드-쿼리 책임 분리(CQRS, Command Query Responsibility Segregation)
- 반응 및 액터 모델: DDD 와 함께 액터 모델에서 사용하는 액터 모델(Reactive)에서의 반응 메시징 패턴
- REST(Representational State Transfer)
- 서비스 지향 아키텍처
- MSA
