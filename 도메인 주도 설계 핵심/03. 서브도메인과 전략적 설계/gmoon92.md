# 3장 서브도메인과 전략적 설계

DDD 프로젝트를 진행할 때, 항상 그 안에는 다수의 바운디드 컨텍스트가 존재한다.

- 이 바운디드 컨텍스트들 중 하나는 핵심 도메인이 될 것이다.
- 다른 바운디드 컨텍스트에는 다양한 서브 도메인이 존재한다.

특정 보편언어로 모델을 서로 다르게 나누고 여러 개의 바운디드 컨텍스트로 구성하는 것의 중요하다.

- 바운디드 컨텍스트마다 하나의 서브도메인, 각 서브도메인마다 하나의 바운디드 컨텍스트로 구성된다.
- 애자일 프로젝트 관리 핵심은 하나의 바운디드 컨텍스트와 하나의 서브도메인 모두를 포함한다는 것이다.
- 드물긴 하지만 하나의 바운디드 컨텍스트 안에 다수의 서브도메인이 있을 수도 있다. 이 경우에는 최적의 모델을 구성했다고 보기엔 어렵다.

## 서브도메인은 무엇인가?

서브도메인은 전체 비즈니스 도메인의 하위 부분이다.

- 대부분의 비즈니스 도메인은 보통 전체를 포괄적으로 생각하기엔 너무 크고 복잡하다.
- 서브도메인이 하나의 논리적 도메인 모델을 나타내는 것이라고 생각할 수도 있다.
- 거대하고 복잡한 프로젝트에서 문제 영역을 이해할 수 있도록 전체 비즈니스 도메인을 논리적으로 쪼개는 데 사용한다.
- 서브도메인은 명확한 전문 지식 영역별로 정의한다.
  - 비즈니스 핵심 영역에 대해 해결 방안을 제시하는 책임의 소유 관점에서 나온다.
  - 특정 서브도메인에는 서브 도메인을 활성화시킬 수 있도록 해당 비즈니스를 잘 이해하고 있는 한 명 이상의 도메인 전문가들이 있다는 것을 의미한다.
  - 서브도메인에는 크든, 작든 비즈니스에 대한 전략적 의의가 있다.

서브도메인을 개발하는 데 DDD를 사용했다면 명확한 바운디드 컨텍스트를 구현할 수 있다.

## 서브도메인의 유형

프로젝트에는 세 가지 주요 서브도메인 유형이 있다.

- 핵심 도메인
  - 보편언어를 신중하게 만들기 위한 전략적 투자 영역이다.
  - 주요 자원을 할당하는 명시적인 바운디드 컨텍스트다.
  - 이 도메인은 다른 경쟁자들에 대한 차별화를 만들 영역이기 때문에, 프로젝트 목록에서 높은 우선순위를 갖는다.
  - 기업이 모든 것을 차별화할 수는 없기 때문에 핵심 도메인은 기업이 뛰어나야 하는 부분에 대한 경계를 구분해준다.
  - 소프트웨어에서 가장 큰 투자가 필요한 곳이다.
- 지원 서브도메인
  - 이미 존재하는 제품으로 해결할 수 없는 맞춤 제작 개발이 필요한 모델링 영역을 말한다.
  - 전략적 차별화를 위해 투자한 것에 실패하지 않으면서도 지원 형태의 바운디드 컨텍스트에 너무 큰 투자를 하지 않기 위해 아웃소싱을 고려해볼 수도 있다.
  - 지원 서브도메인 없이 핵심 도메인을 성공시킬 수는 없기 때문에 중요한 소프트웨어 모델이다.
- 일반 서브도메인
  - 기존 제품 구매를 통해 바로 충족시킬 수 있는 경우에 해당한다.
  - 하지만 아웃소싱을 할 수도 있고, 핵심 도메인 또는 좀 더 작은 지원 서브도메인에 할당된, 엘리트 개발자가 없는 팀에서 직접 개발할 수도 있다.
  - 일반 서브도메인을 핵심 도메인으로 오해하지 않도록 주의해야 한다.

DDD를 사용하고 있는 프로젝트에 대해 논한다면. 핵심 도메인에 대한 논의는 반드시 필요하다.

## 복잡성 다루기

비즈니스 도메인 안의 시스템 경계 중 일부는 레거시 시스템일 가능성이 높다.

- 이런 경우 레거시 시스템을 개선하는 작업들을 많이 진행하기 어려울 수도 있다.
- 하지만 그 시스템들이 핵심 도메인 프로젝트에 어떤 영향을 주고 있는지는 명확히 해야 한다.

레거시 시스템의 문제 영역에 대해 논의하기 위한 도구로 서브도메인을 사용해야 한다.

실무에선 일부 레거시 시스템들은 바운디드 컨텍스트를 기반으로 설계하는 DDD의 방향과는 상충되기 때문에 이것들을 제한된 경계가 없는(unbounded) 레거시 시스템(진흙 덩어리)으로 여길 수 밖에 없다.

- 레거시 시스템을 논할 때, 하나 이상의 논리적(Logical) 도메인 모델이 존재한다면, 이것을 서브도메인으로 생각해볼 수도 있다.
- 경계가 없는 레거시로 굳어버린 큰 진흙 덩어리안에 논리적 서브도메인으로 구분한다.
- 구분된 서브도메인을 DDD의 여러 개의 바운디드 컨텍스트로 생각해볼 수 있다.
- 구분된 보편언어를 머리속에 떠올려보면, 최소한 이 레거시 시스템을 어떻게 통합해야 할지 이해하는 데 도움이 된다.
- 서브도메인을 활용해서 레거시 시스템을 바라보고 논의해보자.

서브도메인을 활용하면, 작업 중이거나 관련 있는 핵심 도메인을 하나의 간단한 다이어그램 안에 표현해볼 수 있다.

이 다이어그램(컨텍스트 매핑)은 서브도메인 간 관련성과 의존성을 이해하는 데 도움된다.

- DDD를 사용할 때, 바운디드 컨텍스트와 서브도메인은 일대일 관계를 맺어야 한다. 
- 하나의 바운디드 컨텍스트 안에 오직 1개의 서브도메인 모델을 두는 것을 목표로 한다.
- 이는 바운디드 컨텍스트를 정확하게 유지시키고 핵심 전략 목표에 집중하는 데 도움을 준다.

만약 핵심 도메인 안에 존재하는 동일한 바운디드 컨텍스트 안에 다른 모델을 만들어야 하는 상황이라면, 핵심 도메인으로부터 완전히 분리된 모듈 형태로 그 모델을 별도의 영역에 정의해야 한다.

레거시 시스템에서 서브도메인을 구분하는 일은 해결 영역에 계속 적용해 나간다.
